        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>PolygonShape Class / box2d Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="box2d" data-type="PolygonShape">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../box2d.html">box2d</a> &rsaquo; <a href="../box2d/PolygonShape.html">PolygonShape</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>PolygonShape</strong>
          Class
        </h2>
        
<div class="doc">
<p>Convex Polygon Shape. Create using Body.createShape(ShapeDef) rather than the
constructor here, which is off-limits to the likes of you.</p>
</div>
<h3>Extends</h3>
<p>
<span class="type-box"><span class="icon-class"></span><a href="../box2d/Shape.html">Shape</a></span>&nbsp;&gt;&nbsp;<span class="type-box"><span class="icon-class"></span><strong>PolygonShape</strong></span></p>
<h3>Constructors</h3>
<div class="method"><h4 id="PolygonShape">
<span class="show-code">Code</span>
new <strong>PolygonShape</strong>() <a class="anchor-link" href="#PolygonShape"
              title="Permalink to PolygonShape.PolygonShape">#</a></h4>
<div class="doc">
<p>Constructs a new PolygonShape.</p>
<pre class="source">
PolygonShape() :
    super(ShapeType.POLYGON, Settings.POLYGON_RADIUS),
    vertexCount = 0,
    vertices = new List&lt;Vector&gt;(Settings.MAX_POLYGON_VERTICES),
    normals = new List&lt;Vector&gt;(Settings.MAX_POLYGON_VERTICES),
    centroid = new Vector() {
  for (int i = 0; i &lt; vertices.length; ++i)
    vertices[i] = new Vector();
  for (int i = 0; i &lt; normals.length; ++i)
    normals[i] = new Vector();
}
</pre>
</div>
</div>
<div class="method"><h4 id="PolygonShape">
<span class="show-code">Code</span>
new <strong>PolygonShape</strong>.copy(<a href="../box2d/PolygonShape.html">PolygonShape</a> other) <a class="anchor-link" href="#PolygonShape"
              title="Permalink to PolygonShape.PolygonShape">#</a></h4>
<div class="doc">
<p>Constructs a new PolygonShape equal to the given shape.</p>
<pre class="source">
PolygonShape.copy(PolygonShape other) :
    super(ShapeType.POLYGON, other.radius),
    vertexCount = other.vertexCount,
    vertices = new List&lt;Vector&gt;(Settings.MAX_POLYGON_VERTICES),
    normals = new List&lt;Vector&gt;(Settings.MAX_POLYGON_VERTICES),
    centroid = new Vector.copy(other.centroid) {
  // Copy the vertices and normals from the other polygon shape.
  for (int i = 0; i &lt; other.vertices.length; ++i)
    vertices[i] = new Vector.copy(other.vertices[i]);

  for (int i = 0; i &lt; other.normals.length; ++i)
    normals[i] = new Vector.copy(other.normals[i]);
}
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="applyTransformToCentroid">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>applyTransformToCentroid</strong>(<a href="../box2d/Transform.html">Transform</a> xf) <a class="anchor-link" href="#applyTransformToCentroid"
              title="Permalink to PolygonShape.applyTransformToCentroid">#</a></h4>
<div class="doc">
<p>Get the centroid and apply the supplied transform.</p>
<pre class="source">
Vector applyTransformToCentroid(Transform xf) =&gt; Transform.mul(xf, centroid);
</pre>
</div>
</div>
<div class="method"><h4 id="centroidToOut">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>centroidToOut</strong>(<a href="../box2d/Transform.html">Transform</a> xf, <a href="../box2d/Vector.html">Vector</a> out) <a class="anchor-link" href="#centroidToOut"
              title="Permalink to PolygonShape.centroidToOut">#</a></h4>
<div class="doc">
<p>Get the centroid and apply the supplied transform. Return the result
through the return parameter out.</p>
<pre class="source">
Vector centroidToOut(Transform xf, Vector out) {
  Transform.mulToOut(xf, centroid, out);
  return out;
}
</pre>
</div>
</div>
<div class="method"><h4 id="clone">
<span class="show-code">Code</span>
<a href="../box2d/Shape.html">Shape</a> <strong>clone</strong>() <a class="anchor-link" href="#clone"
              title="Permalink to PolygonShape.clone">#</a></h4>
<div class="doc">

<pre class="source">
Shape clone() =&gt; new PolygonShape.copy(this);
</pre>
</div>
</div>
<div class="method"><h4 id="computeAxisAlignedBox">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>computeAxisAlignedBox</strong>(<a href="../box2d/AxisAlignedBox.html">AxisAlignedBox</a> argAabb, <a href="../box2d/Transform.html">Transform</a> argXf) <a class="anchor-link" href="#computeAxisAlignedBox"
              title="Permalink to PolygonShape.computeAxisAlignedBox">#</a></h4>
<div class="doc">
<p>See Shape.computeAxisAlignedBox(AABB, Transform).</p>
<pre class="source">
void computeAxisAlignedBox(AxisAlignedBox argAabb, Transform argXf) {
  final Vector lower = new Vector();
  final Vector upper = new Vector();
  final Vector v = new Vector();

  Transform.mulToOut(argXf, vertices[0], lower);
  upper.setFrom(lower);

  for (int i = 1; i &lt; vertexCount; ++i) {
    Transform.mulToOut(argXf, vertices[i], v);
    Vector.minToOut(lower, v, lower);
    Vector.maxToOut(upper, v, upper);
  }

  argAabb.lowerBound.x = lower.x - radius;
  argAabb.lowerBound.y = lower.y - radius;
  argAabb.upperBound.x = upper.x + radius;
  argAabb.upperBound.y = upper.y + radius;
}
</pre>
</div>
</div>
<div class="method"><h4 id="computeCentroidToOut">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>computeCentroidToOut</strong>(<a href="../dart_core/List.html">List</a> vs, <a href="../dart_core/int.html">int</a> count, <a href="../box2d/Vector.html">Vector</a> out) <a class="anchor-link" href="#computeCentroidToOut"
              title="Permalink to PolygonShape.computeCentroidToOut">#</a></h4>
<div class="doc">
<p>Compute the centroid and store the value in the given out parameter.</p>
<pre class="source">
void computeCentroidToOut(List&lt;Vector&gt; vs, int count, Vector out) {
  assert (count &gt;= 3);

  out.setCoords(0.0, 0.0);
  num area = 0.0;

  if (count == 2) {
    out.setFrom(vs[0]).addLocal(vs[1]).mulLocal(.5);
    return;
  }

  // pRef is the reference point for forming triangles.
  // It's location doesn't change the result (except for rounding error).
  final Vector pRef = new Vector();
  pRef.setZero();

  final Vector e1 = new Vector();
  final Vector e2 = new Vector();

  final num inv3 = 1.0 / 3.0;

  for (int i = 0; i &lt; count; ++i) {
    // Triangle vertices.
    final Vector p1 = pRef;
    final Vector p2 = vs[i];
    final Vector p3 = i + 1 &lt; count ? vs[i + 1] : vs[0];

    e1.setFrom(p2).subLocal(p1);
    e2.setFrom(p3).subLocal(p1);

    final num D = Vector.crossVectors(e1, e2);

    final num triangleArea = 0.5 * D;
    area += triangleArea;

    // Area weighted centroid
    out.addLocal(p1).addLocal(p2).addLocal(p3).mulLocal(triangleArea * inv3);
  }

  // Centroid
  assert (area &gt; Settings.EPSILON);
  out.mulLocal(1.0 / area);
}
</pre>
</div>
</div>
<div class="method"><h4 id="computeMass">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>computeMass</strong>(<a href="../box2d/MassData.html">MassData</a> massData, <a href="../dart_core/num.html">num</a> density) <a class="anchor-link" href="#computeMass"
              title="Permalink to PolygonShape.computeMass">#</a></h4>
<div class="doc">
<p>See Shape.computeMass(MassData)</p>
<pre class="source">
void computeMass(MassData massData, num density) {
  // Polygon mass, centroid, and inertia.
  // Let rho be the polygon density in mass per unit area.
  // Then:
  // mass = rho * int(dA)
  // centroid.x = (1/mass) * rho * int(x * dA)
  // centroid.y = (1/mass) * rho * int(y * dA)
  // I = rho * int((x*x + y*y) * dA)
  //
  // We can compute these integrals by summing all the integrals
  // for each triangle of the polygon. To evaluate the integral
  // for a single triangle, we make a change of variables to
  // the (u,v) coordinates of the triangle:
  // x = x0 + e1x * u + e2x * v
  // y = y0 + e1y * u + e2y * v
  // where 0 &lt;= u &amp;&amp; 0 &lt;= v &amp;&amp; u + v &lt;= 1.
  //
  // We integrate u from [0,1-v] and then v from [0,1].
  // We also need to use the Jacobian of the transformation:
  // D = cross(e1, e2)
  //
  // Simplification: triangle centroid = (1/3) * (p1 + p2 + p3)
  //
  // The rest of the derivation is handled by computer algebra.

  assert (vertexCount &gt;= 2);

  // A line segment has zero mass.
  if (vertexCount == 2) {
    // massData.center = 0.5 * (vertices[0] + vertices[1]);
    massData.center.setFrom(vertices[0]).addLocal(vertices[1]).mulLocal(0.5);
    massData.mass = 0.0;
    massData.inertia = 0.0;
    return;
  }

  final Vector center = new Vector();
  center.setZero();
  num area = 0.0;
  num I = 0.0;

  // pRef is the reference point for forming triangles.
  // It's location doesn't change the result (except for rounding error).
  final Vector pRef = new Vector();
  pRef.setZero();

  final num k_inv3 = 1.0 / 3.0;

  final Vector e1 = new Vector();
  final Vector e2 = new Vector();

  for (int i = 0; i &lt; vertexCount; ++i) {
    // Triangle vertices.
    final Vector p1 = pRef;
    final Vector p2 = vertices[i];
    final Vector p3 = i + 1 &lt; vertexCount ? vertices[i + 1] : vertices[0];

    e1.setFrom(p2);
    e1.subLocal(p1);

    e2.setFrom(p3);
    e2.subLocal(p1);

    final num D = Vector.crossVectors(e1, e2);

    final num triangleArea = 0.5 * D;
    area += triangleArea;

    // Area weighted centroid
    center.x += triangleArea * k_inv3 * (p1.x + p2.x + p3.x);
    center.y += triangleArea * k_inv3 * (p1.y + p2.y + p3.y);

    final num px = p1.x;
    final num py = p1.y;
    final num ex1 = e1.x;
    final num ey1 = e1.y;
    final num ex2 = e2.x;
    final num ey2 = e2.y;

    final num intx2 = k_inv3 * (0.25 * (ex1 * ex1 + ex2 * ex1 + ex2 * ex2) +
        (px * ex1 + px * ex2)) + 0.5 * px * px;
    final num inty2 = k_inv3 * (0.25 * (ey1 * ey1 + ey2 * ey1 + ey2 * ey2) +
        (py * ey1 + py * ey2)) + 0.5 * py * py;

    I += D * (intx2 + inty2);
  }

  // Total mass
  massData.mass = density * area;

  // Center of mass
  assert (area &gt; Settings.EPSILON);
  center.mulLocal(1.0 / area);
  massData.center.setFrom(center);

  // Inertia tensor relative to the local origin.
  massData.inertia = I * density;
}
</pre>
</div>
</div>
<div class="method"><h4 id="getSupport">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a> <strong>getSupport</strong>(<a href="../box2d/Vector.html">Vector</a> d) <a class="anchor-link" href="#getSupport"
              title="Permalink to PolygonShape.getSupport">#</a></h4>
<div class="doc">
<p>Get the supporting vertex index in the given direction.</p>
<pre class="source">
int getSupport(Vector d) {
  int bestIndex = 0;
  num bestValue = Vector.dot(vertices[0], d);
  for (int i = 1; i &lt; vertexCount; ++i) {
    num value = Vector.dot(vertices[i], d);
    if (value &gt; bestValue) {
      bestIndex = i;
      bestValue = value;
    }
  }
  return bestIndex;
}
</pre>
</div>
</div>
<div class="method"><h4 id="getSupportVertex">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>getSupportVertex</strong>(<a href="../box2d/Vector.html">Vector</a> d) <a class="anchor-link" href="#getSupportVertex"
              title="Permalink to PolygonShape.getSupportVertex">#</a></h4>
<div class="doc">
<p>Get the supporting vertex in the given direction.</p>
<pre class="source">
Vector getSupportVertex(Vector d) =&gt; vertices[getSupport(d)];
</pre>
</div>
</div>
<div class="method"><h4 id="getVertex">
<span class="show-code">Code</span>
<a href="../box2d/Vector.html">Vector</a> <strong>getVertex</strong>(<a href="../dart_core/int.html">int</a> index) <a class="anchor-link" href="#getVertex"
              title="Permalink to PolygonShape.getVertex">#</a></h4>
<div class="doc">
<p>Get a vertex by index.</p>
<pre class="source">
Vector getVertex(int index) =&gt; vertices[index];
</pre>
</div>
</div>
<div class="method"><h4 id="setAsBox">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>setAsBox</strong>(<a href="../dart_core/num.html">num</a> hx, <a href="../dart_core/num.html">num</a> hy) <a class="anchor-link" href="#setAsBox"
              title="Permalink to PolygonShape.setAsBox">#</a></h4>
<div class="doc">
<p>Build vertices to represent an axis-aligned box.
hx is the half-width of the body and hy is the half height.</p>
<pre class="source">
void setAsBox(num hx, num hy) {
  vertexCount = 4;
  vertices[0].setCoords(-hx, -hy);
  vertices[1].setCoords(hx, -hy);
  vertices[2].setCoords(hx, hy);
  vertices[3].setCoords(-hx, hy);
  normals[0].setCoords(0.0, -1.0);
  normals[1].setCoords(1.0, 0.0);
  normals[2].setCoords(0.0, 1.0);
  normals[3].setCoords(-1.0, 0.0);
  centroid.setZero();
}
</pre>
</div>
</div>
<div class="method"><h4 id="setAsBoxWithCenterAndAngle">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>setAsBoxWithCenterAndAngle</strong>(<a href="../dart_core/num.html">num</a> hx, <a href="../dart_core/num.html">num</a> hy, <a href="../box2d/Vector.html">Vector</a> center, <a href="../dart_core/num.html">num</a> angle) <a class="anchor-link" href="#setAsBoxWithCenterAndAngle"
              title="Permalink to PolygonShape.setAsBoxWithCenterAndAngle">#</a></h4>
<div class="doc">
<p>Build vertices to represent an oriented box. hx is the halfwidth, hy the
half-height, center is the center of the box in local coordinates and angle
is the rotation of the box in local coordinates.</p>
<pre class="source">
void setAsBoxWithCenterAndAngle(num hx, num hy, Vector center, num angle) {
  vertexCount = 4;
  vertices[0].setCoords(-hx, -hy);
  vertices[1].setCoords(hx, -hy);
  vertices[2].setCoords(hx, hy);
  vertices[3].setCoords(-hx, hy);
  normals[0].setCoords(0.0, -1.0);
  normals[1].setCoords(1.0, 0.0);
  normals[2].setCoords(0.0, 1.0);
  normals[3].setCoords(-1.0, 0.0);
  centroid.setFrom(center);

  Transform xf = new Transform();
  xf.position.setFrom(center);
  xf.rotation.setAngle(angle);

  // Transform vertices and normals.
  for (int i = 0; i &lt; vertexCount; ++i) {
    Transform.mulToOut(xf, vertices[i], vertices[i]);
    Matrix22.mulMatrixAndVectorToOut(xf.rotation, normals[i], normals[i]);
  }
}
</pre>
</div>
</div>
<div class="method"><h4 id="setAsEdge">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>setAsEdge</strong>(<a href="../box2d/Vector.html">Vector</a> v1, <a href="../box2d/Vector.html">Vector</a> v2) <a class="anchor-link" href="#setAsEdge"
              title="Permalink to PolygonShape.setAsEdge">#</a></h4>
<div class="doc">
<p>Set this as a single edge.</p>
<pre class="source">
void setAsEdge(Vector v1, Vector v2) {
  vertexCount = 2;
  vertices[0].setFrom(v1);
  vertices[1].setFrom(v2);
  centroid.setFrom(v1).addLocal(v2).mulLocal(0.5);
  normals[0].setFrom(v2).subLocal(v1);
  Vector.crossVectorAndNumToOut(normals[0], 1, normals[0]);
  normals[0].normalize();
  normals[1].setFrom(normals[0]).negateLocal();
}
</pre>
</div>
</div>
<div class="method"><h4 id="setFrom">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>setFrom</strong>(<a href="../dart_core/List.html">List</a> otherVertices, <a href="../dart_core/int.html">int</a> count) <a class="anchor-link" href="#setFrom"
              title="Permalink to PolygonShape.setFrom">#</a></h4>
<div class="doc">
<p>Copy vertices. This assumes the vertices define a convex polygon.
It is assumed that the exterior is the the right of each edge.
TODO(dominich): Consider removing 
<span class="param">count</span>.</p>
<pre class="source">
void setFrom(List&lt;Vector&gt; otherVertices, int count) {
  assert (2 &lt;= count &amp;&amp; count &lt;= Settings.MAX_POLYGON_VERTICES);
  vertexCount = count;

  // Copy vertices.
  for (int i = 0; i &lt; vertexCount; ++i) {
    assert(vertices[i] !== null);
    vertices[i].setFrom(otherVertices[i]);
  }

  Vector edge = new Vector();

  // Compute normals. Ensure the edges have non-zero length.
  for (int i = 0; i &lt; vertexCount; ++i) {
    final int i1 = i;
    final int i2 = i + 1 &lt; vertexCount ? i + 1 : 0;
    edge.setFrom(vertices[i2]).subLocal(vertices[i1]);

    assert (edge.lengthSquared &gt; Settings.EPSILON * Settings.EPSILON);
    Vector.crossVectorAndNumToOut(edge, 1, normals[i]);
    normals[i].normalize();
  }

  // Compute the polygon centroid.
  computeCentroidToOut(vertices, vertexCount, centroid);
}
</pre>
</div>
</div>
<div class="method"><h4 id="testPoint">
<span class="show-code">Code</span>
<a href="../dart_core/bool.html">bool</a> <strong>testPoint</strong>(<a href="../box2d/Transform.html">Transform</a> xf, <a href="../box2d/Vector.html">Vector</a> p) <a class="anchor-link" href="#testPoint"
              title="Permalink to PolygonShape.testPoint">#</a></h4>
<div class="doc">
<p>See Shape.testPoint(Transform, Vector).</p>
<pre class="source">
bool testPoint(Transform xf, Vector p) {
  Vector pLocal = new Vector();

  pLocal.setFrom(p).subLocal(xf.position);
  Matrix22.mulTransMatrixAndVectorToOut(xf.rotation, pLocal, pLocal);

  Vector temp = new Vector();

  for (int i = 0; i &lt; vertexCount; ++i) {
    temp.setFrom(pLocal).subLocal(vertices[i]);
    if (Vector.dot(normals[i], temp) &gt; 0)
      return false;
  }

  return true;
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="centroid">
<span class="show-code">Code</span>
final <a href="../box2d/Vector.html">Vector</a>         <strong>centroid</strong> <a class="anchor-link"
            href="#centroid"
            title="Permalink to PolygonShape.centroid">#</a>
        </h4>
        <div class="doc">
<p>Local position of the shape centroid in parent body frame.</p>
<pre class="source">
final Vector centroid;
</pre>
</div>
</div>
<div class="field"><h4 id="normals">
<span class="show-code">Code</span>
final <a href="../dart_core/List.html">List</a>         <strong>normals</strong> <a class="anchor-link"
            href="#normals"
            title="Permalink to PolygonShape.normals">#</a>
        </h4>
        <div class="doc">
<p>The normals of the shape. Note: Use getVertexCount() rather than
normals.length to get the number of active normals.</p>
<pre class="source">
final List&lt;Vector&gt; normals;
</pre>
</div>
</div>
<div class="field"><h4 id="vertexCount">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>vertexCount</strong> <a class="anchor-link"
            href="#vertexCount"
            title="Permalink to PolygonShape.vertexCount">#</a>
        </h4>
        <div class="doc">

<pre class="source">
int vertexCount;
</pre>
</div>
</div>
<div class="field"><h4 id="vertices">
<span class="show-code">Code</span>
final <a href="../dart_core/List.html">List</a>         <strong>vertices</strong> <a class="anchor-link"
            href="#vertices"
            title="Permalink to PolygonShape.vertices">#</a>
        </h4>
        <div class="doc">
<p>The vertices of the shape. Note: Use getVertexCount() rather than
vertices.length to get the number of active vertices.</p>
<pre class="source">
final List&lt;Vector&gt; vertices;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page generated at 2012-07-30 08:57:52.456</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
