        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>TimeOfImpact Class / box2d Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="box2d" data-type="TimeOfImpact">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../box2d.html">box2d</a> &rsaquo; <a href="../box2d/TimeOfImpact.html">TimeOfImpact</a></div>
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>TimeOfImpact</strong>
          Class
        </h2>
        
<div class="doc">
<p>Class used for computing the time of impact. This class should not be
constructed usually, just retrieve from the SingletonPool.getTimeOfImpact().</p>
</div>
<h3>Static Fields</h3>
<div class="field"><h4 id="MAX_ITERATIONS">
<span class="show-code">Code</span>
final <a href="../dart_core/int.html">int</a>         <strong>MAX_ITERATIONS</strong> <a class="anchor-link"
            href="#MAX_ITERATIONS"
            title="Permalink to TimeOfImpact.MAX_ITERATIONS">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static final int MAX_ITERATIONS = 1000;
</pre>
</div>
</div>
<div class="field"><h4 id="toiCalls">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>toiCalls</strong> <a class="anchor-link"
            href="#toiCalls"
            title="Permalink to TimeOfImpact.toiCalls">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static int toiCalls;
</pre>
</div>
</div>
<div class="field"><h4 id="toiIters">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>toiIters</strong> <a class="anchor-link"
            href="#toiIters"
            title="Permalink to TimeOfImpact.toiIters">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static int toiIters;
</pre>
</div>
</div>
<div class="field"><h4 id="toiMaxIters">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>toiMaxIters</strong> <a class="anchor-link"
            href="#toiMaxIters"
            title="Permalink to TimeOfImpact.toiMaxIters">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static int toiMaxIters;
</pre>
</div>
</div>
<div class="field"><h4 id="toiMaxRootIters">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>toiMaxRootIters</strong> <a class="anchor-link"
            href="#toiMaxRootIters"
            title="Permalink to TimeOfImpact.toiMaxRootIters">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static int toiMaxRootIters;
</pre>
</div>
</div>
<div class="field"><h4 id="toiRootIters">
<span class="show-code">Code</span>
<a href="../dart_core/int.html">int</a>         <strong>toiRootIters</strong> <a class="anchor-link"
            href="#toiRootIters"
            title="Permalink to TimeOfImpact.toiRootIters">#</a>
        </h4>
        <div class="doc">

<pre class="source">
static int toiRootIters;
</pre>
</div>
</div>
<h3>Methods</h3>
<div class="method"><h4 id="timeOfImpact">
<span class="show-code">Code</span>
<a href="../dart_core/void.html">void</a> <strong>timeOfImpact</strong>(<a href="../box2d/TimeOfImpactOutput.html">TimeOfImpactOutput</a> output, <a href="../box2d/TimeOfImpactInput.html">TimeOfImpactInput</a> input) <a class="anchor-link" href="#timeOfImpact"
              title="Permalink to TimeOfImpact.timeOfImpact">#</a></h4>
<div class="doc">
<p>Compute the upper bound on time before two shapes penetrate. Time is
represented as a fraction between <code>0,tMax</code>. This uses a swept separating
axis and may miss some intermediate, non-tunneling collision. If you
change the time interval, you should call this function again.
Note: use Distance to compute the contact point and normal at the time
of impact.</p>
<pre class="source">
void timeOfImpact(TimeOfImpactOutput output, TimeOfImpactInput input) {
  // CCD via the local separating axis method. This seeks progression
  // by computing the largest time at which separation is maintained.
  ++toiCalls;

  output.state = TimeOfImpactOutputState.UNKNOWN;
  output.t = input.tMax;

  DistanceProxy proxyA = input.proxyA;
  DistanceProxy proxyB = input.proxyB;

  sweepA.setFrom(input.sweepA);
  sweepB.setFrom(input.sweepB);

  // Large rotations can make the root finder fail, so we normalize the
  // sweep angles.
  sweepA.normalize();
  sweepB.normalize();

  num tMax = input.tMax;

  num totalRadius = proxyA.radius + proxyB.radius;
  num target = Math.max(Settings.LINEAR_SLOP, totalRadius
      - 3.0 * Settings.LINEAR_SLOP);
  num tolerance = 0.25 * Settings.LINEAR_SLOP;

  assert (target &gt; tolerance);

  num t1 = 0;
  int iter = 0;

  cache.count = 0;
  distanceInput.proxyA = input.proxyA;
  distanceInput.proxyB = input.proxyB;
  distanceInput.useRadii = false;

  // The outer loop progressively attempts to compute new separating axes.
  // This loop terminates when an axis is repeated (no progress is made).
  while (true) {
    sweepA.getTransform(xfA, t1);
    sweepB.getTransform(xfB, t1);
    // Get the distance between shapes. We can also use the results
    // to get a separating axis
    distanceInput.transformA = xfA;
    distanceInput.transformB = xfB;
    pool.distance.distance(distanceOutput, cache, distanceInput);

    // If the shapes are overlapped, we give up on continuous collision.
    if (distanceOutput.distance &lt;= 0) {
      // Failure!
      output.state = TimeOfImpactOutputState.OVERLAPPED;
      output.t = 0;
      break;
    }

    if (distanceOutput.distance &lt; target + tolerance) {
      // Victory!
      output.state = TimeOfImpactOutputState.TOUCHING;
      output.t = t1;
      break;
    }

    // Initialize the separating axis.
    fcn.initialize(cache, proxyA, sweepA, proxyB, sweepB, t1);

    // Compute the TimeOfImpact on the separating axis. We do this by successively
    // resolving the deepest point. This loop is bounded by the number of
    // vertices.
    bool done = false;
    num t2 = tMax;
    int pushBackIter = 0;
    while (true) {

      // Find the deepest point at t2. Store the witness point indices.
      num s2 = fcn.findMinSeparation(indexes, t2);
      // Is the configuration separated?
      if (s2 &gt; target + tolerance) {
        // Victory!
        output.state = TimeOfImpactOutputState.SEPARATED;
        output.t = tMax;
        done = true;
        break;
      }

      // Has the separation reached tolerance?
      if (s2 &gt; target - tolerance) {
        // Advance the sweeps
        t1 = t2;
        break;
      }

      // Compute the initial separation of the witness points.
      num s1 = fcn.evaluate(indexes[0], indexes[1], t1);
      // Check for initial overlap. This might happen if the root finder
      // runs out of iterations.
      if (s1 &lt; target - tolerance) {
        output.state = TimeOfImpactOutputState.FAILED;
        output.t = t1;
        done = true;
        break;
      }

      // Check for touching
      if (s1 &lt;= target + tolerance) {
        // Victory! t1 should hold the TimeOfImpact (could be 0.0).
        output.state = TimeOfImpactOutputState.TOUCHING;
        output.t = t1;
        done = true;
        break;
      }

      // Compute 1D root of: f(x) - target = 0
      int rootIterCount = 0;
      num a1 = t1, a2 = t2;
      while (true) {
        // Use a mix of the secant rule and bisection.
        num t;
        if ((rootIterCount &amp; 1) == 1) {
          // Secant rule to improve convergence.
          t = a1 + (target - s1) * (a2 - a1) / (s2 - s1);
        } else {
          // Bisection to guarantee progress.
          t = 0.5 * (a1 + a2);
        }

        num s = fcn.evaluate(indexes[0], indexes[1], t);

        if ((s - target).abs() &lt; tolerance) {
          // t2 holds a tentative value for t1
          t2 = t;
          break;
        }

        // Ensure we continue to bracket the root.
        if (s &gt; target) {
          a1 = t;
          s1 = s;
        } else {
          a2 = t;
          s2 = s;
        }

        ++rootIterCount;
        ++toiRootIters;

        // djm: whats with this? put in settings?
        if (rootIterCount == 50) {
          break;
        }
      }

      toiMaxRootIters = Math.max(toiMaxRootIters, rootIterCount);

      ++pushBackIter;

      if (pushBackIter == Settings.MAX_POLYGON_VERTICES) {
        break;
      }
    }

    ++iter;
    ++toiIters;

    if (done)
      break;

    if (iter == MAX_ITERATIONS) {
      // Root finder got stuck. Semi-victory.
      output.state = TimeOfImpactOutputState.FAILED;
      output.t = t1;
      break;
    }
  }

  toiMaxIters = Math.max(toiMaxIters, iter);
}
</pre>
</div>
</div>
<h3>Fields</h3>
<div class="field"><h4 id="cache">
<span class="show-code">Code</span>
final <a href="../box2d/SimplexCache.html">SimplexCache</a>         <strong>cache</strong> <a class="anchor-link"
            href="#cache"
            title="Permalink to TimeOfImpact.cache">#</a>
        </h4>
        <div class="doc">
<p>Pool variables</p>
<pre class="source">
final SimplexCache cache;
</pre>
</div>
</div>
<div class="field"><h4 id="distanceInput">
<span class="show-code">Code</span>
final <a href="../box2d/DistanceInput.html">DistanceInput</a>         <strong>distanceInput</strong> <a class="anchor-link"
            href="#distanceInput"
            title="Permalink to TimeOfImpact.distanceInput">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final DistanceInput distanceInput;
</pre>
</div>
</div>
<div class="field"><h4 id="distanceOutput">
<span class="show-code">Code</span>
final <a href="../box2d/DistanceOutput.html">DistanceOutput</a>         <strong>distanceOutput</strong> <a class="anchor-link"
            href="#distanceOutput"
            title="Permalink to TimeOfImpact.distanceOutput">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final DistanceOutput distanceOutput;
</pre>
</div>
</div>
<div class="field"><h4 id="fcn">
<span class="show-code">Code</span>
final <a href="../box2d/SeparationFunction.html">SeparationFunction</a>         <strong>fcn</strong> <a class="anchor-link"
            href="#fcn"
            title="Permalink to TimeOfImpact.fcn">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final SeparationFunction fcn;
</pre>
</div>
</div>
<div class="field"><h4 id="indexes">
<span class="show-code">Code</span>
final <a href="../dart_core/List.html">List</a>         <strong>indexes</strong> <a class="anchor-link"
            href="#indexes"
            title="Permalink to TimeOfImpact.indexes">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final List&lt;int&gt; indexes;
</pre>
</div>
</div>
<div class="field"><h4 id="pool">
<span class="show-code">Code</span>
<a href="../box2d/DefaultWorldPool.html">DefaultWorldPool</a>         <strong>pool</strong> <a class="anchor-link"
            href="#pool"
            title="Permalink to TimeOfImpact.pool">#</a>
        </h4>
        <div class="doc">

<pre class="source">
DefaultWorldPool pool;
</pre>
</div>
</div>
<div class="field"><h4 id="sweepA">
<span class="show-code">Code</span>
final <a href="../box2d/Sweep.html">Sweep</a>         <strong>sweepA</strong> <a class="anchor-link"
            href="#sweepA"
            title="Permalink to TimeOfImpact.sweepA">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final Sweep sweepA;
</pre>
</div>
</div>
<div class="field"><h4 id="sweepB">
<span class="show-code">Code</span>
final <a href="../box2d/Sweep.html">Sweep</a>         <strong>sweepB</strong> <a class="anchor-link"
            href="#sweepB"
            title="Permalink to TimeOfImpact.sweepB">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final Sweep sweepB;
</pre>
</div>
</div>
<div class="field"><h4 id="xfA">
<span class="show-code">Code</span>
final <a href="../box2d/Transform.html">Transform</a>         <strong>xfA</strong> <a class="anchor-link"
            href="#xfA"
            title="Permalink to TimeOfImpact.xfA">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final Transform xfA;
</pre>
</div>
</div>
<div class="field"><h4 id="xfB">
<span class="show-code">Code</span>
final <a href="../box2d/Transform.html">Transform</a>         <strong>xfB</strong> <a class="anchor-link"
            href="#xfB"
            title="Permalink to TimeOfImpact.xfB">#</a>
        </h4>
        <div class="doc">

<pre class="source">
final Transform xfB;
</pre>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        
        <div class="footer">
          <div>This page generated at 2012-07-30 08:57:51.836</div>
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
